#!/usr/bin/env lua5.1

local lfs = require("lfs")

local repo_path = lfs.currentdir()

local repo = require("munin.repo").init(repo_path)

if arg[1] == "init" then
    local init_err = repo.create_new()
    if init_err then
        print("[Error] Failed to initialize repository at "..repo._path..": "..init_err)
    else
        print("Initialized new repository at "..repo._path)
    end
elseif (arg[1] == "get-note") then
    local title = arg[2]
    local note, err = repo.get_note(title)
    if note then
        print(note.title)
        print(note.content)
    elseif err then
        print("[Error] "..err)
    else
        print("Note titled '"..title.."' not found")
    end
elseif (arg[1] == "add-note") then
    local title = arg[2]
    local content = io.read("*a")
    local _, err = repo.add_note(title, content, "")
    if err then
        print("[Error] "..err)
    end
end
